<section class="section">
  <div class="container">
    <!--Nav and article control-->
    <nav>
      <div class="field is-grouped">

        <p class="control">
          <a class="button">
            <span class="icon is-small">
              {{fa-icon 'globe'}}
            </span>
            <span>Official</span>
          </a>
        </p>

        {{#if (await (can 'unwatch article' article))}}
          <p class="control">
            <a class="button is-primary is-disabled">
              <span class="icon is-small">
                {{fa-icon 'eye'}}
              </span>
            </a>
          </p>
        {{else}}{{#if (await (can 'watch article' article))}}
          <p class="control">
            {{#ui.form.-async-button class='button is-primary'
                                     disableWhen=(not currentUser)
                                     action=(action '_watchArticle' article) as |component state|}}
              {{#if state.isRejected}}
                <span class="icon is-small">
                  {{fa-icon 'exclamation-circle'}}
                </span>
                <span>Error</span>
              {{else}}{{#if state.isFulfilled}}
                <span class="icon is-small">
                  {{fa-icon 'check-circle-o'}}
                </span>
              {{else}}
                <span class="icon is-small">
                  {{fa-icon 'eye'}}
                </span>
                <span>Watch</span>
              {{/if}}{{/if}}
            {{/ui.form.-async-button}}
          </p>
        {{/if}}{{/if}}

        <p class="control">
          {{#ui.form.-async-button class='button is-success'
                                   disableWhen=(not currentUser)
                                   action=(action '_soldArticle' article) as |component state|}}
            {{#if state.isRejected}}
              <span class="icon is-small">
                {{fa-icon 'exclamation-circle'}}
              </span>
              <span>Error</span>
            {{else}}{{#if state.isFulfilled}}
              <span class="icon is-small">
                {{fa-icon 'check-circle-o'}}
              </span>
              <span>Watched</span>
            {{else}}
              <span class="icon is-small">
                {{fa-icon 'shopping-bag'}}
              </span>
              <span>Sold</span>
            {{/if}}{{/if}}
          {{/ui.form.-async-button}}
        </p>

      </div>
    </nav>
    <hr>
    <p class="title content is-capitalize has-text-right">{{article.name}}</p>
    <p class="subtitle content has-text-right is-small mb-1">
      Indexed <bold>{{moment-from-now article.createdAt}}</bold>
    </p>
  </div>


  <div class="container">
    <div class="columns is-row-reverse">

      <!--Price panel-->
      <div class="column is-4">
        <div class="card is-fullwidth">
          <div class="level">
            <div class="level-item">
              <span class="icon">{{fa-icon 'arrow-up' class='is-primary'}}</span>
            </div>
            <div class="level-item">
              {{ui.-money article.price 'cad' showCode=true}}
            </div>
            <div class="level-item">
              {{ui.-money article.price 'jpy' showCode=true}}
            </div>
          </div>
          <div class="level">
            <div class="level-item price-history-container">
              {{ui.sparkline.-line data=(map-by 'price' (sort-by 'createdAt:desc' article.priceHistory.history))}}
            </div>
          </div>
        </div>

        <table class="table is-bordered is-narrow is-striped mt-2 is-fullwidth">
          <tbody>
          {{#if article.priceSummary.max}}
            <tr>
              <td><b>Highest</b></td>
              <td>${{article.priceSummary.max.price}}</td>
              <td>{{moment-from-now article.priceSummary.max.seenAt}}</td>
            </tr>
          {{/if}}

          {{#if article.priceSummary.min}}
            <tr>
              <td><b>Lowest</b></td>
              <td>${{article.priceSummary.min.price}}</td>
              <td>{{moment-from-now article.priceSummary.min.seenAt}}</td>
            </tr>
          {{/if}}
          </tbody>
        </table>
      </div>

      <!--Article panel-->
      <div class="column is-8">
        <article class="message">
          <div class="message-header">Description</div>
          <div class="message-body">{{article.description}}</div>
        </article>

      </div>


    </div>
  </div>
</section>
<section class="section">
  <div class="container">
    <hr>
    <div class="title is-3 has-text-right">Related</div>
    <div class="columns">
      {{#each (repeat 6) as |empty|}}
        <div class="column is-2">
          <div class="card">
            <div class="card-image">
              <figure class="image is-4by3">
                <img src="http://placehold.it/300x225" alt="">
              </figure>
            </div>
            <div class="card-content">
              <p class="title is-6">Article 1</p>
            </div>
          </div>
        </div>
      {{/each}}
    </div>
  </div>
</section>
